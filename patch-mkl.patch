From 727a78b21d1fa4ac40dee012d2002fcfcd953a86 Mon Sep 17 00:00:00 2001
From: Maarten Arnst <maarten.arnst@uliege.be>
Date: Wed, 16 Mar 2022 16:28:12 +0100
Subject: [PATCH] Patch solves compilation error observed when linking with
 Intel One API MKL version >= 2021.

---
 packages/stokhos/src/Stokhos_SDMUtils.hpp | 17 +++++++++++++++--
 1 file changed, 15 insertions(+), 2 deletions(-)

diff --git a/packages/stokhos/src/Stokhos_SDMUtils.hpp b/packages/stokhos/src/Stokhos_SDMUtils.hpp
index d93319320aa..aaf00461786 100644
--- a/packages/stokhos/src/Stokhos_SDMUtils.hpp
+++ b/packages/stokhos/src/Stokhos_SDMUtils.hpp
@@ -50,9 +50,22 @@
 #include <ostream>
 
 #define DGEQP3_F77  F77_BLAS_MANGLE(dgeqp3,DGEQP3)
+
+#if defined(INTEL_MKL)
+    #include "mkl_version.h"
+#endif
+
 extern "C" {
-void DGEQP3_F77(const int*, const int*, double*, const int*, int*,
-                double*, double*, const int*, int*);
+#if defined(INTEL_MKL) && __INTEL_MKL__ >= 2021
+    // MKL defines NOTHROW
+    void dgeqp3_( const MKL_INT* m, const MKL_INT* n, double* a,
+        const MKL_INT* lda, MKL_INT* jpvt, double* tau, double* work,
+        const MKL_INT* lwork, MKL_INT* info ) NOTHROW;
+#else
+    void dgeqp3_( const MKL_INT* m, const MKL_INT* n, double* a,
+        const MKL_INT* lda, MKL_INT* jpvt, double* tau, double* work,
+        const MKL_INT* lwork, MKL_INT* info );
+#endif
 }
 
 #include "Stokhos_ConfigDefs.h"
-- 
2.25.1

